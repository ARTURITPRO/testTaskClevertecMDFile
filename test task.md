
# Тестовое задание 1
## Требования к  приложению:
Стек: Java 21 и Gradle 8.4
При команде gradle:build / mvn:package должен создаться Jar архив с названием clevertec-check.jar (с манифестом), который должен запускаться командой:

```sh
java -jar clevertec-check.jar
```

Примечания:

Gradle:

https://www.baeldung.com/gradle-run-java-main
https://stackoverflow.com/questions/32567167/gradle-no-main-manifest-attribute

Maven:

https://maven.apache.org/shared/maven-archiver/examples/classpath.html
https://stackoverflow.com/questions/9689793/cant-execute-jar-file-no-main-manifest-attribute

Разработать консольное приложение, реализующее функционал формирования чека в магазине
В данном задании важно показать понимание ООП, умение строить модели (выделять классы, интерфейсы, их связи),
разделять функционал между ними, а также знать синтаксис самого языка. Обязательно применение паттернов проектирования
(Factory, Builder, Decorator). Обратить внимание на устойчивость к изменениям в логике и избегать копипаста
Приложение должно запускаться с помощью консольной команды:

```sh
  java -jar clevertec-check.jar id-quantity discountCard=xxxx balanceDebitCard=xxxx
```

где:

id					    - идентификатор товара (см. Таблицу 1)

quantity 				- количество товара

discountCard=xxxx 		- название и номер дисконтной карты (см. Таблицу 2)

balanceDebitCard=xxxx 	- баланс на дебетовой карте

### Примечание:
- все указываем через  пробел.
- id-quantity - добавляем префикс  id-(количество товара). В  наборе параметров должна быть минимум одна такая связка "id-quantity"
  ВАЖНО! Id могут повторяться: 1-3 2-5 1-1 тоже, что и 1-4 2-5
- discountCard=xxxx - добавляем префикс discountCard=(любые четыре цифры)
- balanceDebitCard=xxxx - указываем префикс balanceDebitCard=(любая сумма на счете). Сумма может быть как и с двумя знаками после запятой, так и отрицательной
  ВАЖНО! xxxx - для числа с плавающей точкой разделитель точка. Пример: 1.12

### Пример:
```sh
java -jar clevertec-check.jar 3-1 2-5 5-1 discountCard=1111 balanceDebitCard=100
```
По команде выше должен сформироваться CSV-файл содержащий в себе список товаров и их количество с ценой, а также рассчитанную сумму с учетом скидки по предъявленной карте, если она есть.

Расшифровка команды:

(3-1) 3 - это товар с id = 3,  1 - количество (1шт);  тоже самое с (2-5) id=2 в количестве 5 штук, (5-1) id=5 - одна штука и т. д.; discountCard=1111 - означает, что была предъявлена скидочная карта с номером 1111.
- Необходимо продублировать чек в консоль (рисунок 1)
- Среди товаров, предусмотрены оптовые (Таблица 1, колонка wholesale product).
- Если в чеке, в оптовой позиции пять и более товаров, то сделать скидку 10% по этой позиции (если применяется оптовая скидка 10% на позицию, то на данную позицию не действует персональная скидка по карте, например 3%). Данную информацию отразить в чеке
- Набор товаров и скидочных карт вычитывать из файла (названия файлов произвольные).
- Их количество и номенклатура взять строго из Таблицы 1 и Таблицы 2 (изменять или добавлять ничего нельзя)
- Реализовать обработку исключений (например, нет товара с id или не передан баланс карты и т. д.) смотри схемы 5, 6, 7
- Реализовать вывод чека в CSV-файл (формат приведен на схеме 1). Также продублировать расширенно всю необходимую информацию в консоль (на свое усмотрение что и как)
- Описать README.md файл в свободной форме (используемый стек, инструкцию по запуску)
- Исходники разместить в присланном репозитории в ветке feature/core
- Покрыть функционал юнит-тестами (не менее 70 %)


# Тестовое задание 2

Реализовать считывание списка товаров из внешнего файла (CSV заданного формата в схеме 11) и сохранение данных чека в указанный CSV-файл на вход добавлены параметры pathToFile=xxxx и saveToFile=xxxx
- pathToFile - включает относительный (от корневой директории проекта) путь + название файла с расширением (всегда присутствует в заданном формате)
- saveToFile - включает относительный (от корневой директории проекта) путь + название файла с расширением

Приложение должно запускаться с помощью консольной команды:
```sh
java -jar clevertec-check.jar id-quantity discountCard=xxxx balanceDebitCard=xxxx pathToFile=XXXX saveToFile=xxxx
```
Исходники разместить в присланном репозитории в ветке feature/core-read-from-file

“*” - Необязательно, но будет существенным плюсом. К этим пунктам лучше приступать после:
- качественного решения базовых задач с применением принципов SOLID
- декларативных подходов
- оптимальных алгоритмов



# Тестовое задание 3

- Замена хранения исходных данных (п.4) в файлах на хранение в таблицах PostgreSQL: product и discount_card
- Настройки подключения к БД передавать через аргументы командной строки на вход добавлены параметры:

```sh
  datasource.url=ххх datasource.username=ххх datasource.password=ххх
  ```
Пример:
```sh
java -jar clevertec-check.jar 3-1 2-5 5-1 discountCard=1111 balanceDebitCard=100 datasource.url=jdbc:postgresql://localhost:5432/check datasource.username=postgres datasource.password=postgres
  ```

* DDL/DML операции должны храниться в файле src/main/resources/data.sql (но не использоваться);
* Исходники разместить в присланном репозитории в ветке feature/database
* Покрыть функционал юнит-тестами (не менее 70 %)

“*” - Необязательно, но будет существенным плюсом. К этим пунктам лучше приступать после:
- качественного решения базовых задач с применением принципов SOLID
- декларативных подходов
- оптимальных алгоритмов

# Тестовое задание 4

* Реализовать RESTFUL - API (Servlet).
* Данные вычитывать из БД (п.10).
* Также при старте приложения БД очищается и заполняется новыми данными из файла
* Cделать возможность добавлять товары и карты по REST (реализовать CRUD на эти две таблицы).
* При формировании чека товары в БД должны уменьшаться на запрошенное количество (если не было ошибки и хватило денег на счету).
* UI реализовывать не нужно.
* Исходники разместить в присланном репозитории в ветке feature/rest
* Покрыть функционал юнит-тестами (не менее 70 %)

Примеры запросов:

* Получать чек (в ответе должен быть CSV-файл)
```sh
POST http://localhost:8080/check
{
"product": [
{
"id": 1,
"quantity": 5
},
{
"id": 1,
"quantity": 5
}
],
"discountCard": 1234,
"balanceDebitCard": 100
}
  ```


* Вернуть товар  из БД
```sh
GET http://localhost:8080/products?id=1
```

* Добавить товар в БД
```sh
POST http://localhost:8080/products
{
"description": "Eat 100g.",
"price": 3.25,
"quantity": 5,
"isWholesale ": true
}
```

* Обновить товар в БД
```sh
PUT http://localhost:8080/products?id=1
{
"description": "Chocolate Ritter sport 100g.",
"price": 3.25,
"quantity": 5,
"isWholesale ": true
}
```
* Удалить товар из БД
```sh
DELETE http://localhost:8080/products?id=1
```

* Вернуть дисконтную карту  из БД
```sh
GET http://localhost:8080/discountcards?id=1
```
* Добавить дисконтную карту  в БД
```sh
POST http://localhost:8080/discountcards
{
"discountCard": 5265,
"discountAmount": 2
}
```

* Обновить дисконтную карту в БД по id.
```sh
PUT http://localhost:8080/discountcards?id=1
{
"discountCard": 6786,
"discountAmount": 3
}
```

* Удалить дисконтную карту из БД
```sh
DELETE http://localhost:8080/discountcards?id=1
```

“*” - Необязательно, но будет существенным плюсом. К этим пунктам лучше приступать после:
- качественного решения базовых задач с применением принципов SOLID
- декларативных подходов
- оптимальных алгоритмов

# Тестовое задание 5

- Расширить функционал на свое усмотрение.
- Исходники разместить в присланном репозитории в ветке feature/custom.
- Обязательно указать то, что сделали  в  файле README.md

“*” - Необязательно, но будет существенным плюсом. К этим пунктам лучше приступать после:
- качественного решения базовых задач с применением принципов SOLID
- декларативных подходов
- оптимальных алгоритмов

### Описание CSV-файла:

**Date** - Дата генерации файла   
**Time** - Время генерации файла  
**QTY** - Количество заказанного товара  
**DESCRIPTION** - Название заказанного товара  
**PRICE** - Цена за 1шт  
**TOTAL** - Итоговая цена без скидки (QTY * PRICE)  
**DISCOUNT** - Скидка на итоговую цену товара (TOTAL * DISCOUNT PERCENTAGE / 100)
**DISCOUNT CARD** - Номер скидочной карты  
**DISCOUNT PERCENTAGE** - Процент скидки по карте  
**TOTAL PRICE** - Итоговая цена за все товары (TOTAL 1 + TOTAL 2 + …)  
**TOTAL DISCOUNT** - Итоговая скидка на все товары (DISCOUNT 1 + DISCOUNT 2 + …)  
**TOTAL WITH DISCOUNT** - Итоговая стоимость (TOTAL PRICE - TOTAL DISCOUNT)

Смотри схемы 1, 2, 3, 4

ВАЖНО!:
* Значения разделяются:  ‘;’
* Значения с плавающей точкой пишутся через точку
* Все значения имеющие $ в конце пишутся до 2 знаков после запятой Пример: 1.21$; 0.00$; 142199.09$;

### Описание CSV-файла с исключением:

**ERROR** - при возникновении исключения. С новой строки заполнить сообщение.

Смотри схемы - 5, 6, 7

### Примеры CSV-файла с дисконтной картой:

Схема 1 - Открытие через блокнот:  
https://drive.google.com/file/d/1a6H5P79DtFNxliDmjMIGBBkA9L0TbqMN/view?usp=drive_link  

Схема 2 - Открытие через EXCEL:  
https://drive.google.com/file/d/1Hnq1TlpzKbrggTV6mItU18jBPQCAIjt3/view?usp=drive_link

### Примеры CSV-файла без дисконтной карты:

Схема 3 - Открытие через блокнот:  
https://drive.google.com/file/d/1LjZ7ka_0taDc8F5G-pLJcqrVMLYCzw1P/view?usp=drive_link

Схема 4 - Открытие через EXCEL:  
https://drive.google.com/file/d/1L4nVBibn27v7bN9VhkRbDzb7q2L7MUwN/view?usp=drive_link

### Примеры CSV-файла с исключением:

Схема 5 - Открытие через блокнот:  
https://drive.google.com/file/d/1zMfiGtneRCP6Txm6qd6nOY8SywERvc2d/view?usp=drive_link

Схема 6 - Открытие через EXCEL:  
https://drive.google.com/file/d/1jk7qzSBLHh6VznzjNSKHWNRR8N17a77q/view?usp=drive_link

**ВАЖНО!** Смотрите схему 6 заполнения сообщений.

Схема 7 -  Примеры заполнения сообщений при возникновении исключительных ситуаций:

| Сообщение             | Описание                                                                                           |
|-----------------------|----------------------------------------------------------------------------------------------------|
| BAD REQUEST           | При неверных входных данных (не верно заполнены аргументы, ошибки количества, отсутствия products) |
| NOT ENOUGH MONEY      | При недостатке средств (баланс меньше, чем сумма в чеке)                                           |    
| INTERNAL SERVER ERROR | При любых других ситуациях                                                                         |




**Схема 8. Таблица в DB public**.**product** должна выглядеть следующим образом:

|**column:**| **id**  |**description**|**price** | **quantity\_in\_stock** |**wholesale\_product**|
|:---------:|:-------:|:-------------:|:--------:|:-----------------------:|:--------------------:|
|   type:   |BIGSERIAL|  VARCHAR(50)  | DECIMAL  |         INTEGER         |       BOOLEAN        |

**Схема 9. Таблица в DB public**.**discount\_card** должна выглядеть следующим образом:

|**column:**| **id**  |**number**|**amount** |
|:---------:|:-------:|:--------:|:---------:|
|   type:   |BIGSERIAL| INTEGER  | SMALLINT  |

**ВАЖНО! :**
* Ограничения выставить самостоятельно  
* price - должна хранится до 2 знаков, сокращать по правилам математики (например: 1,20)  
* 0 <= discount amount  <= 100

**Схема 10.** 

Таблица 1. Список доступных products

|**id**|**description**|**price, $**|**quantity  in stock**|**wholesale product**|
| :-: | :-: | :-: | :-: | :-: |
|1|Milk|1,07|10|+|
|2|Cream 400g|2,71|20|+|
|3|Yogurt 400g|2,10|7|+|
|4|Packed potatoes 1kg|1,47|30|-|
|5|Packed cabbage 1kg|1,19|15|-|
|6|Packed tomatoes 350g|1,60|50|-|
|7|Packed apples 1kg|2,78|18|-|
|8|Packed oranges 1kg|3,20|12|-|
|9|Packed bananas 1kg|1,10|25|+|
|10|Packed beef fillet 1kg|12,8|7|-|
|11|Packed pork fillet 1kg|8,52|14|-|
|12|Packed chicken breasts 1kgSour |10,75|18|-|
|13|Baguette 360g|1,30|10|+|
|14|Drinking water 1,5l|0,80|100|-|
|15|Olive oil 500ml|5,30|16|-|
|16|Sunflower oil 1l|1,20|12|-|
|17|Chocolate Ritter sport 100g|1,10|50|+|
|18|Paulaner 0,5l|1,10|100|-|
|19|Whiskey Jim Beam 1l|13,99|30|-|
|20|Whiskey Jack Daniels 1l|17,19|20|-|


Таблица 2. Список доступных discount cards

|id|number|discount amount, %|
| :-: | :-: | :-: |
|1|1111|3|
|2|2222|3|
|3|3333|4|
|4|4444|5|
|Любая другая дисконтная карта  с вашим номером предоставляет 2% скидки. |||

**Схема 11. Пример передаваемого файла с продуктами:**
1) Открытие файла в блокноте  
   https://drive.google.com/file/d/1YHDberj3FlgiReCG2doYN-UjYX6Y8Obs/view?usp=drive_link

2) Открытие файла в Exel:
   https://drive.google.com/file/d/1KXnv-b4jbceEMyiYrlZsfUyZvu30t6Hk/view?usp=drive_link

